<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>产品展示</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#3B82F6',
            secondary: '#1E40AF',
            dark: '#1E293B',
          },
          fontFamily: {
            inter: ['Inter', 'system-ui', 'sans-serif'],
          },
        },
      }
    }
  </script>
  
  <style type="text/tailwindcss">
    @layer utilities {
      /* 轮播核心样式（优化循环滑动兼容性） */
      .carousel-container {
        @apply relative w-full overflow-hidden;
      }
      .carousel-track {
        @apply flex transition-transform duration-500 ease-out; /* 保持平滑过渡 */
      }
      .carousel-item {
        @apply min-w-full relative; /* 确保每项占满容器宽度，为循环奠定基础 */
      }
      .carousel-item img {
        @apply w-full h-full object-cover;
      }
      .indicator {
        @apply w-8 h-2 rounded-full transition-all duration-300 bg-white/50 cursor-pointer;
      }
      .indicator.active {
        @apply bg-primary w-12;
      }
      .carousel-control {
        @apply absolute top-1/2 -translate-y-1/2 z-20 w-10 h-10 flex items-center justify-center rounded-full bg-black/30 text-white hover:bg-primary transition-all duration-300 cursor-pointer;
      }

      /* 视频区域样式 */
      .video-container {
        @apply relative w-full rounded-xl overflow-hidden shadow-lg bg-dark;
        padding-top: 56.25%; /* 16:9 标准视频比例 */
      }
      .video-container video {
        @apply absolute inset-0 w-full h-full object-contain;
      }

      /* 交互提示样式 */
      .swipe-hint {
        @apply absolute bottom-20 left-1/2 -translate-x-1/2 bg-black/50 text-white px-4 py-2 rounded-full text-sm flex items-center gap-2 z-10 animate-pulse md:hidden;
      }
    }
  </style>
</head>
<body class="font-inter bg-gray-100 min-h-screen flex items-center justify-center p-4">
  <div class="container mx-auto px-4 py-8 max-w-7xl">
    <!-- 轮播容器（优化循环滑动逻辑） -->
    <div class="carousel-container rounded-xl shadow-2xl mb-8" style="max-height: 80vh;">
      <!-- 轮播轨道 -->
      <div id="carouselTrack" class="carousel-track">
        <!-- 轮播项1 -->
        <div class="carousel-item">
          <img src="images/1.jpg" alt="产品展示图1" class="w-full h-full object-cover">
          <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/70 to-transparent p-6 text-white">
            <h2 class="text-2xl md:text-3xl font-bold mb-2">能量转移型主动均衡板</h2>
            <p>高效电池管理解决方案</p>
          </div>
        </div>
        
        <!-- 轮播项2 -->
        <div class="carousel-item">
          <img src="images/2.jpg" alt="产品展示图2" class="w-full h-full object-cover">
          <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/70 to-transparent p-6 text-white">
            <h2 class="text-2xl md:text-3xl font-bold mb-2">智能电池管理系统</h2>
            <p>延长电池寿命，提升使用效率</p>
          </div>
        </div>
        
        <!-- 轮播项3 -->
        <div class="carousel-item">
          <img src="images/3.jpg" alt="产品展示图3" class="w-full h-full object-cover">
          <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/70 to-transparent p-6 text-white">
            <h2 class="text-2xl md:text-3xl font-bold mb-2">多规格适配设计</h2>
            <p>满足不同场景的电池需求</p>
          </div>
        </div>
        
        <!-- 轮播项4 -->
        <div class="carousel-item">
          <img src="images/3.jpg" alt="产品展示图4" class="w-full h-full object-cover">
          <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/70 to-transparent p-6 text-white">
            <h2 class="text-2xl md:text-3xl font-bold mb-2">精密控制技术</h2>
            <p>稳定可靠的性能表现</p>
          </div>
        </div>
      </div>
      
      <!-- 滑动提示 -->
      <div class="swipe-hint">
        <i class="fa fa-arrows-h"></i> 左右滑动切换
      </div>
      
      <!-- 指示器 -->
      <div class="absolute bottom-6 left-0 right-0 flex justify-center gap-2 z-20">
        <div class="indicator active" data-index="0"></div>
        <div class="indicator" data-index="1"></div>
        <div class="indicator" data-index="2"></div>
        <div class="indicator" data-index="3"></div>
      </div>
      
      <!-- 左右控制按钮 
      <button id="prevBtn" class="carousel-control left-4">
        <i class="fa fa-chevron-left"></i>
      </button>
      <button id="nextBtn" class="carousel-control right-4">
        <i class="fa fa-chevron-right"></i>
      </button>-->
    </div>
    
    <!-- 视频播放区域 -->
    <section class="mb-8">
      <div class="flex flex-col md:flex-row gap-6">
        <!-- 视频播放器 -->
        <div class="w-full md:w-2/3">
          <div class="video-container">
            <video 
              controls
              poster="images/3.jpg"
              preload="metadata">
              <source src="your-video-file.mp4" type="video/mp4">
              <source src="your-video-file.webm" type="video/webm">
              您的浏览器不支持视频播放
           </video>
          </div>
        </div>
        
        <!-- 视频信息 -->
        <div class="w-full md:w-1/3 bg-white p-6 rounded-xl shadow-lg flex flex-col justify-center">
          <h2 class="text-2xl font-bold text-gray-800 mb-3">产品参数</h2>
          <p class="text-gray-600 mb-4">
            这是一款能量转移型主动均衡板，能有效延长电池寿命。
          </p>
          <ul class="text-gray-600 space-y-2 mb-6">
            <li class="flex items-start">
              <i class="fa fa-check-circle text-primary mt-1 mr-2"></i>
              <span>均衡功率 0-8安 0-100瓦</span>
            </li>
            <li class="flex items-start">
              <i class="fa fa-check-circle text-primary mt-1 mr-2"></i>
              <span>电池容量 10-200安通用</span>
            </li>
            <li class="flex items-start">
              <i class="fa fa-check-circle text-primary mt-1 mr-2"></i>
              <span>适用   24-48伏  24-60伏  24-72伏</span>
            </li>
            <li class="flex items-start">
              <i class="fa fa-check-circle text-primary mt-1 mr-2"></i>
              <span>智能温控保护系统</span>
            </li>
            <li class="flex items-start">
              <i class="fa fa-check-circle text-primary mt-1 mr-2"></i>
              <span>高效能量转换技术</span>
            </li>
          </ul>
          <button class="bg-primary hover:bg-secondary text-white py-3 px-6 rounded-lg transition-all duration-300 transform hover:scale-[1.02] focus:outline-none focus:ring-2 focus:ring-primary focus:ring-opacity-50">
            查看详细规格
          </button>
        </div>
      </div>
    </section>
  </div>

  <script>
    // 轮播核心逻辑（重点优化左右循环滑动）
    const carouselTrack = document.getElementById('carouselTrack');
    const carouselItems = document.querySelectorAll('.carousel-item');
    const indicators = document.querySelectorAll('.indicator');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const swipeHint = document.querySelector('.swipe-hint');

    let currentIndex = 0;
    const itemCount = carouselItems.length;
    let isDragging = false;
    let startX;
    let currentTranslate = 0;
    let prevTranslate = 0;
    let animationID;

    // 初始化轮播（优化无缝循环的克隆项逻辑）
    function initCarousel() {
      // 1. 复制首尾项并标记为克隆项（关键：实现循环时的视觉衔接）
      const firstClone = carouselItems[0].cloneNode(true); // 复制第一项（用于最后一项向右滑的衔接）
      const lastClone = carouselItems[itemCount - 1].cloneNode(true); // 复制最后一项（用于第一项向左滑的衔接）
      firstClone.classList.add('clone');
      lastClone.classList.add('clone');

      // 2. 插入克隆项：最后一项后加第一项克隆，第一项前加最后一项克隆
      carouselTrack.appendChild(firstClone);
      carouselTrack.insertBefore(lastClone, carouselItems[0]);

      // 3. 初始位置设为原第一项（跳过左侧的最后项克隆）
      currentIndex = 1; 
      setPositionByIndex();
      setupEventListeners();

      // 隐藏滑动提示
      setTimeout(() => {
        swipeHint.classList.add('opacity-0', 'transition-opacity', 'duration-1000');
        setTimeout(() => swipeHint.style.display = 'none', 1000);
      }, 3000);
    }

    // 设置轮播位置（优化循环时的索引映射）
    function setPositionByIndex() {
      // 计算当前需要移动的距离（百分比，每项占100%宽度）
      currentTranslate = currentIndex * -100;
      prevTranslate = currentTranslate;
      carouselTrack.style.transform = `translateX(${currentTranslate}%)`;
      carouselTrack.style.transition = 'transform 0.5s ease-out'; // 保持过渡动画

      // 优化指示器同步：映射克隆项索引到原项索引
      let targetIndicatorIndex;
      if (currentIndex === 0) {
        // 当前是左侧克隆项（原最后一项），对应指示器的最后一个
        targetIndicatorIndex = itemCount - 1;
      } else if (currentIndex === itemCount + 1) {
        // 当前是右侧克隆项（原第一项），对应指示器的第一个
        targetIndicatorIndex = 0;
      } else {
        // 当前是原项，直接对应（currentIndex-1 因为初始currentIndex=1对应原第一项）
        targetIndicatorIndex = currentIndex - 1;
      }
      // 更新指示器激活状态
      indicators.forEach((indicator, i) => {
        indicator.classList.toggle('active', i === targetIndicatorIndex);
      });
    }

    // 处理过渡结束（核心：修复循环时的"跳变"问题）
    function handleTransitionEnd() {
      // 情况1：从原最后一项（currentIndex=itemCount）向右滑到右侧克隆项（currentIndex=itemCount+1）
      if (currentIndex === itemCount + 1) {
        // 关闭过渡动画，瞬间跳回原第一项（避免用户看到"回跳"）
        carouselTrack.style.transition = 'none';
        currentIndex = 1; // 跳回原第一项的位置（对应currentIndex=1）
        setPositionByIndex();
      } 
      // 情况2：从原第一项（currentIndex=1）向左滑到左侧克隆项（currentIndex=0）
      else if (currentIndex === 0) {
        carouselTrack.style.transition = 'none';
        currentIndex = itemCount; // 跳回原最后一项的位置（对应currentIndex=itemCount）
        setPositionByIndex();
      }
    }

    // 切换下一项（兼容手动点击和拖拽）
    function nextSlide() {
      if (isDragging) return; // 拖拽中禁止点击切换
      currentIndex++;
      setPositionByIndex();
    }

    // 切换上一项（兼容手动点击和拖拽）
    function prevSlide() {
      if (isDragging) return;
      currentIndex--;
      setPositionByIndex();
    }

    // 滑动事件（优化拖拽体验，确保循环滑动流畅）
    function touchStart(e) {
      // 记录初始触摸/鼠标位置
      startX = e.type === 'touchstart' ? e.changedTouches[0].clientX : e.clientX;
      isDragging = true;
      carouselTrack.style.transition = 'none'; // 拖拽时关闭过渡，避免卡顿
      animationID = requestAnimationFrame(animation);
    }

    function touchMove(e) {
      if (!isDragging) return;
      // 计算当前移动距离
      const x = e.type === 'touchmove' ? e.changedTouches[0].clientX : e.clientX;
      currentTranslate = prevTranslate + (x - startX) / carouselTrack.parentElement.offsetWidth * 100; // 按容器宽度比例计算
    }

    function touchEnd() {
      cancelAnimationFrame(animationID);
      isDragging = false;
      carouselTrack.style.transition = 'transform 0.5s ease-out'; // 结束拖拽后恢复过渡

      // 判断是否需要切换项（移动距离超过50px则切换）
      const movedBy = currentTranslate - prevTranslate;
      if (movedBy < -10) { // 向左滑动超过10%宽度，切换下一项
        nextSlide();
      } else if (movedBy > 10) { // 向右滑动超过10%宽度，切换上一项
        prevSlide();
      } else {
        // 移动距离不足，回弹到原位置
        setPositionByIndex();
      }
    }

    // 动画帧（确保拖拽时实时更新位置）
    function animation() {
      carouselTrack.style.transform = `translateX(${currentTranslate}%)`;
      if (isDragging) requestAnimationFrame(animation);
    }

    // 事件监听（整合所有交互方式）
    function setupEventListeners() {
      // 1. 指示器点击（映射到原项索引）
      indicators.forEach((indicator, i) => {
        indicator.addEventListener('click', () => {
          currentIndex = i + 1; // 因为currentIndex=1对应原第一项
          setPositionByIndex();
        });
      });

      // 2. 控制按钮点击
      prevBtn.addEventListener('click', prevSlide);
      nextBtn.addEventListener('click', nextSlide);

      // 3. 触摸/鼠标拖拽（支持移动端和桌面端）
      const container = carouselTrack.parentElement;
      container.addEventListener('touchstart', touchStart);
      container.addEventListener('touchmove', touchMove);
      container.addEventListener('touchend', touchEnd);
      container.addEventListener('mousedown', touchStart);
      container.addEventListener('mousemove', touchMove);
      container.addEventListener('mouseup', touchEnd);
      container.addEventListener('mouseleave', touchEnd); // 鼠标移出容器时结束拖拽

      // 4. 键盘左右键控制
      document.addEventListener('keydown', (e) => {
        if (e.key === 'ArrowLeft') prevSlide();
        else if (e.key === 'ArrowRight') nextSlide();
      });

      // 5. 过渡结束事件（关键：处理克隆项切换后的无缝跳变）
      carouselTrack.addEventListener('transitionend', handleTransitionEnd);
    }

    // 页面加载完成后初始化轮播
    window.addEventListener('DOMContentLoaded', initCarousel);
  </script>
</body>
</html>

